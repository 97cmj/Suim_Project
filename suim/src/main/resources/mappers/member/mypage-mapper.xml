<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="mypageMapper">

	<resultMap id="boardResultSet" type="board">
		<result column="BOARD_NO" property="boardNo" />
		<result column="BOARD_TITLE" property="boardTitle" />
		<result column="MEMBER_ID" property="memberId" />
		<result column="BOARD_VIEW" property="boardView" />
		<result column="BOARD_DATE" property="boardDate" />
		<result column="ORIGIN_NAME" property="originName" />
		<result column="BOARD_CONTENT" property="boardContent" />
		<result column="CHANGE_NAME" property="changeName" />
		<result column="BOARD_REPLY_COUNT" property="replyCount" />
	</resultMap>

	<resultMap id="findResultSet" type="find">
		<result column="FIND_NO" property="findNo" />
		<result column="FIND_TITLE" property="findTitle" />
		<result column="FIND_CATEGORY" property="category" />
		<result column="MEMBER_ID" property="memberId" />
		<result column="FIND_VIEW" property="findView" />
		<result column="FIND_DATE" property="findDate" />
		<result column="ORIGIN_NAME" property="originName" />
		<result column="FIND_CONTENT" property="findContent" />
		<result column="CHANGE_NAME" property="changeName" />
		<result column="FIND_REPLY_COUNT" property="replyCount" />
	</resultMap>
	
	<resultMap id="wishResultSet" type="myWish">
		<result column="HOUSE_NO" property="houseNo" />
		<result column="MEMBER_ID" property="memberId" />
		<result column="HOUSE_ADDRESS" property="houseAddress" />
		<result column="HOUSE_NAME" property="houseName" />
		<result column="RES_GENDER" property="resGender" />
		<result column="DEPOSIT" property="deposit" />
		<result column="RENT" property="rent" />
	</resultMap>
	

	<!-- 자유게시판 게시글 갯수 -->
	<select id="selectBoardListCount" parameterType="string" resultType="_int">
		SELECT COUNT(*)
		FROM BOARD
		WHERE STATUS = 'Y'
		AND MEMBER_ID = #{memberId}
	</select>

	<!-- 게시글 리스트를 구해주는 쿼리문 -->
	<select id="selectBoardList" parameterType="string" resultMap="boardResultSet">
		SELECT
		B.BOARD_NO,
		B.BOARD_TITLE,

		B.BOARD_CONTENT,

		B.BOARD_VIEW,
		B.BOARD_DATE,
		B.STATUS,
		B.MEMBER_ID,
		BA.ORIGIN_NAME,
		BA.CHANGE_NAME,
		COUNT(BR.BRE_NO) AS BOARD_REPLY_COUNT
		FROM BOARD B

		JOIN
		MEMBER M ON
		(M.MEMBER_ID = B.MEMBER_ID)
		LEFT JOIN BATTACHMENT BA ON
		(BA.BOARD_NO =
		B.BOARD_NO)
		LEFT JOIN BOARD_REPLY BR ON (BR.BOARD_NO =
		B.BOARD_NO)

		WHERE B.STATUS = 'Y'
		AND M.MEMBER_ID = #{memberId}
		GROUP BY
		B.BOARD_NO,
		B.BOARD_TITLE,

		B.BOARD_CONTENT,

		B.BOARD_VIEW,
		B.BOARD_DATE,
		B.STATUS,
		B.MEMBER_ID,
		BA.ORIGIN_NAME,
		BA.CHANGE_NAME

		ORDER BY B.BOARD_NO
		DESC

	</select>

	<select id="selectFindListCount" parameterType="string" resultType="_int">
		SELECT COUNT(*)
		FROM FIND
		WHERE STATUS = 'Y'
		AND MEMBER_ID = #{memberId}
	</select>


	<!-- 게시글 리스트를 구해주는 쿼리문 -->
	<select id="selectFindList" resultMap="findResultSet">

		SELECT
		F.FIND_NO,
		F.FIND_TITLE,
		F.FIND_CONTENT,

		F.FIND_CATEGORY,
		F.FIND_VIEW,
		F.FIND_DATE,
		F.STATUS,
		F.MEMBER_ID,
		FA.ORIGIN_NAME,
		FA.CHANGE_NAME,

		COUNT(FR.FRE_NO) AS
		FIND_REPLY_COUNT
		FROM FIND F
		JOIN MEMBER M ON (M.MEMBER_ID =
		F.MEMBER_ID)
		LEFT JOIN FATTACHMENT FA ON (FA.FIND_NO = F.FIND_NO)
		LEFT
		JOIN FIND_REPLY FR ON (FR.FIND_NO = F.FIND_NO)
		WHERE F.STATUS = 'Y'
		AND
		M.MEMBER_ID = #{memberId}
		GROUP BY
		F.FIND_NO,
		F.FIND_TITLE,
		F.FIND_CONTENT,

		F.FIND_CATEGORY,
		F.FIND_VIEW,
		F.FIND_DATE,
		F.STATUS,
		F.MEMBER_ID,
		FA.ORIGIN_NAME,
		FA.CHANGE_NAME
		ORDER BY F.FIND_NO DESC

	</select>
	
	<update id="deleteBoard" parameterType="hashMap">
	    UPDATE BOARD
	    SET STATUS = 'N'
	    WHERE BOARD_NO IN
	    <foreach item="boardNo" collection="intArray" open="(" separator="," close=")">
	        #{boardNo}
	    </foreach>
	    AND MEMBER_ID = #{memberId}
	</update>
	
	<update id="deleteFind" parameterType="hashMap">
	    UPDATE FIND
	    SET STATUS = 'N'
	    WHERE FIND_NO IN
	    <foreach item="findNo" collection="intArray" open="(" separator="," close=")">
	        #{findNo}
	    </foreach>
	    AND MEMBER_ID = #{memberId}
	</update>
	
	<update id="deleteInreview" parameterType="hashMap">
	    UPDATE INREVIEW
	    SET STATUS = 'N'
	    WHERE INR_NO IN
	    <foreach item="inrNo" collection="intArray" open="(" separator="," close=")">
	        #{inrNo}
	    </foreach>
	    AND MEMBER_ID = #{memberId}
	</update>



		<!-- 자유게시판 게시글 갯수 -->
	<select id="selectWishListCount" parameterType="string" resultType="_int">
		SELECT COUNT(*) FROM WISH W
		JOIN HOUSE H USING (HOUSE_NO)
		JOIN PHOTO P USING (HOUSE_NO)  
		WHERE H.HOUSE_STATUS = 'Y'   
		AND W.MEMBER_ID = #{memberId}
	</select>

	<!-- 게시글 리스트를 구해주는 쿼리문 -->
	<select id="selectWishList" parameterType="string" resultMap="wishResultSet">
		SELECT * FROM WISH W
		JOIN HOUSE H USING (HOUSE_NO)
		JOIN PHOTO P USING (HOUSE_NO)  
		WHERE H.HOUSE_STATUS = 'Y'   
		AND W.MEMBER_ID = #{memberId}
	</select>






</mapper>